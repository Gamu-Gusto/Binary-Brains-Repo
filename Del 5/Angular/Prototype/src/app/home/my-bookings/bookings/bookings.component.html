<script src="cardvalidator.js"></script>
  <table class="table" *ngFor="let booking of listUserBookings">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Class Name</th>
        <th scope="col">Payment Status</th>
        <th scope="col">Cancel Booking</th>
        <th scope="col"  *ngIf="booking.bookingStatus !=='Pending Refund'">Refund</th>
      </tr>
    </thead>
    <tbody>
      <tr >
        <th scope="row">
            <div class="image-card">
            <img class="card-img-top" src="../../../assets/art-class/theme1.png" alt="Card image cap">
        </div>
        </th>
        <td>{{booking.artClass.artClassDescription}}</td>
        <td>{{booking.bookingStatus}}</td>
        <td>
            <button mdbBtn type="button" gradient="peach" rounded="true" (click)="onCancelBooking(cancelBookingModal)" mdbWavesEffect>Cancel <i class="fas fa-times-circle"></i></button>
        </td>
        <td>
            <button *ngIf="booking.bookingStatus ==='Pending Payment'" mdbBtn type="button" gradient="purple" rounded="true" (click)="makePayment(makePamentModal,booking)" mdbWavesEffect>Make Payment</button> 

            <button *ngIf="booking.bookingStatus ==='Paid'"mdbBtn type="button" gradient="purple" rounded="true" (click)="onRequestRefund(requestRefundModal,booking)" mdbWavesEffect>Request Refund</button>             

        </td>
      </tr>
    </tbody>
  </table>
  <br>
  <br>

  <!-- ======================================================================================= -->
  <!-- =======================MODALS BELOW================================ -->

  <ng-template #cancelBookingModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Confirm Cancel Booking</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to cancel your Booking?</p>
    </div>
    <div class="modal-footer">
      <button mdbBtn type="button" gradient="purple" (click)="confirmCancel(cancelBookingModal)" rounded="true" mdbWavesEffect>Confirm</button>
    </div>
  </ng-template>

  <ng-template #requestRefundModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Confirm Refund Request</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to cancel your Booking and Request a Refund?</p>
    </div>
    <div class="modal-footer">
      <button mdbBtn type="button" gradient="purple" (click)="confirmRefund(requestRefundModal)" rounded="true" mdbWavesEffect>Confirm</button>
    </div>
  </ng-template>


  <ng-template #makePamentModal let-modal>
    
    <div class="modal-header">
      <h4 class="modal-title">Payment Information</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit($event)">
    <div class="modal-body">
      <div class="cc-types">
        <img class="cc-types__img cc-types__img--amex">
        <img class="cc-types__img cc-types__img--visa">
        <img class="cc-types__img cc-types__img--mastercard">
        <img class="cc-types__img cc-types__img--disc">
        <img class="cc-types__img cc-types__img--genric">
      </div>
      <label>Card Number</label>
      <input formControlName="CardNumber" placeholder="0000 0000 0000 0000" type="text" mask="0000 0000 0000 0000"  class="form-control"  name="CardNumber" >
      <div class="error-messages">
        <ng-container *ngFor="let error of error_messages.CardNumber">
          <div class="error-message" *ngIf="formSubmitted ||  paymentForm.get('CardNumber').hasError(error.type) &&
             (paymentForm.get('CardNumber').dirty || paymentForm.get('CardNumber').touched)">
            {{ error.message }}
          </div>
        </ng-container>
      </div>
      <br>
      <label>Cardholder Name</label>
      <input formControlName="CardHolderName" type="text" class="form-control" placeholder="Name">
      <div class="error-messages">
        <ng-container *ngFor="let error of error_messages.CardHolderName">
          <div class="error-message" *ngIf="formSubmitted ||  paymentForm.get('CardHolderName').hasError(error.type) &&
             (paymentForm.get('CardHolderName').dirty || paymentForm.get('CardHolderName').touched)">
            {{ error.message }}
          </div>
        </ng-container>
      </div>
      <br>
      <label>Expiration Date</label>
      <input formControlName="ExpiryDate" type="text" class="form-control" mask="00/00"  placeholder="00/00">
      <div class="error-messages">
        <ng-container *ngFor="let error of error_messages.ExpiryDate">
          <div class="error-message" *ngIf="formSubmitted ||  paymentForm.get('ExpiryDate').hasError(error.type) &&
             (paymentForm.get('ExpiryDate').dirty || paymentForm.get('ExpiryDate').touched)">
            {{ error.message }}
          </div>
        </ng-container>
      </div>
      <br>
      <label>Security Code</label>
      <input formControlName="Code" type="text" class="form-control" mask="000"  placeholder="CCV">
      <div class="error-messages">
        <ng-container *ngFor="let error of error_messages.Code">
          <div class="error-message" *ngIf="formSubmitted ||  paymentForm.get('Code').hasError(error.type) &&
             (paymentForm.get('Code').dirty || paymentForm.get('Code').touched)">
            {{ error.message }}
          </div>
        </ng-container>
      </div>
    </div>
    <div class="modal-footer">
      <button mdbBtn type="submit"  gradient="purple" (click)="onSubmit($event)" rounded="true" mdbWavesEffect>Continue</button>
    </div>
  </form>
  </ng-template>
  